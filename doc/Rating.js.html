<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Rating.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Rating.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * ZXUI (Zhixin UI)
 * Copyright 2013 Baidu Inc. All rights reserved.
 *
 * @file 评分组件
 * @author hushicai02
 */

define(
    function(require) {
        var lib = require('./lib');
        var Control = require('./Control');

        /**
         * 评分组件
         * TODO: 半星支持
         * 
         * @extends module:Control
         * @requires Control
         * @exports Rating
         */
        var Rating = Control.extend( /** @lends module:Rating.prototype */ {
            options: {
                // 可用性
                disabled: false,
                
                // 主元素
                main: '',

                // class前缀
                prefix: 'ecl-ui-rating',

                // 最多星星数
                max: 5,

                // 星级
                value: 0,

                // 如果需要自定义星星样式，则置为1，然后通过className去控制样式
                skin: 0
            },

            /**
             * 控件类型
             *
             * @const
             * @type {string}
             */
            type: 'Rating',
            
            /**
             * 需要绑定`this`的方法名，多个方法以半角逗号分开
             *
             * @const
             * @type {string}
             */
            binds: 'onClick, onMouseOver, onMouseOut',

            /**
             * 初始化控件
             *
             * @param {Object} options 控件配置项
             * @see module:Rating#options
             * @private
             */
            init: function(options) {
                this.main = lib.g(options.main);
                this.disabled = options.disabled;
            },

            /**
             * 绘制控件
             *
             * @public
             */
            render: function() {
                var options = this.options;

                if (!this.rendered) {
                    this.rendered = true;

                    // 生成星星
                    var html = [];
                    var prefix = options.prefix;

                    html.push('&lt;ul class="'+ prefix + '-stars' +'">');
                    for(var i = 0; i &lt; options.max; i++) {
                        html.push(
                            '&lt;li ',
                                'class="'+ prefix + '-star' +'" ',
                                'data-value="'+ (i + 1) +'"',
                            '>',
                                // 默认星星字符
                                ( options.skin ? '' : '☆' ),
                            '&lt;/li>'
                        );
                    }
                    html.push('&lt;/ul>');
                    this.main.innerHTML = html.join('');

                    this.stars = this.query(prefix + '-star');

                    // 绑定事件
                    var me = this;

                    lib.each(this.stars, function(star) {
                        lib.on(star, 'mouseover', me.onMouseOver);
                        lib.on(star, 'mouseout', me.onMouseOut);
                        lib.on(star, 'click', me.onClick);
                    });
                }

                this.resetRating();

                this.disabled && this.disable();

                return this;
            },

            /**
             * 启用组件
             *
             * @public
             */
            enable: function() {
                lib.removeClass(this.main, this.options.prefix + '-disabled');

                this.parent('enable');
            },

            /**
             * 不启用组件
             *
             * @public
             */
            disable: function() {
                lib.addClass(this.main, this.options.prefix + '-disabled');

                this.parent('disable');
            },

            /**
             * 清洗点亮的星星
             *
             * @private
             */
            drain: function() {
                var options = this.options;
                var prefix = options.prefix;

                var ons = this.query(prefix + '-star-on');   

                lib.each(
                    ons,
                    function(star) {
                        lib.removeClass(star, prefix + '-star-on');
                    }
                );
            },

            /**
             * 按给定星级，从左往右点亮星星
             *
             * @param {number} value 星级
             * @private
             */
            fill: function(value) {
                value = parseInt(value || 0, 10);

                var options = this.options;
                var prefix = options.prefix;
                var result = this.stars.slice(0, value);

                lib.each(
                    result,
                    function(star) {
                        lib.addClass(star, prefix + '-star-on');
                    }
                );

                return result;
            },

            /**
             * 重置星级，避开常用词reset，将方法命名为resetRating
             *
             * @private
             */
            resetRating: function() {
                var options = this.options;
                var value = options.value;
                var prefix = options.prefix;

                var result = this.stars.slice(0, value);

                lib.each(
                    result,
                    function(star) {
                        lib.addClass(star, prefix + '-star-on');
                    }
                );

                return result;
            },

            /**
             * click事件处理
             *
             * @param {?Event} e DOM事件对象
             * @fires module:Rating#rated
             * @private
             */
            onClick: function(e) {
                var options = this.options;
                var prefix = options.prefix;
                var target = lib.getTarget(e);
                var value = options.value;

                if (!e || this.disabled) {
                    return false;
                }

                if (lib.hasClass(target, prefix + '-star')) {
                     var newValue = parseInt(
                        target.getAttribute('data-value'),
                        10
                    );

                    // 如果星级没变化，则不处理
                    if (newValue === value) {
                        return false;
                    }

                    options.value = newValue;

                    this.drain();
                    this.resetRating();

                    /**
                     * @event module:Rating#rated
                     * @type {Object}
                     * @property {number} value 星级
                     */
                    this.fire(
                        'rated',
                        {
                            value: options.value
                        }
                    );
                }
            },

            /**
             * mouseover事件处理
             *
             * @param {?Event} e DOM事件对象
             * @private
             */
            onMouseOver: function(e) {
                var options = this.options;
                var prefix = options.prefix;
                var target = lib.getTarget(e);

                if (!e || this.disabled) {
                    return false;
                }

                if (lib.hasClass(target, prefix + '-star')) {
                    this.drain();
                    this.fill(target.getAttribute('data-value'));
                }
            },

            /**
             * mouseout事件处理
             *
             * @param {?Event} e DOM事件处理
             * @private
             */
            onMouseOut: function(e) {
                var options = this.options;
                var prefix = options.prefix;
                var target = lib.getTarget(e);

                if (!e || this.disabled) {
                    return false;
                }

                if (lib.hasClass(target, prefix + '-star')) {
                    this.drain();
                    this.resetRating();
                }
            },
            
            /**
             * 销毁控件
             *
             * @public
             */
            dispose: function() {
                var me = this;

                // 释放事件
                lib.each(this.stars, function(star) {
                    lib.un(star, 'click', me.onClick);
                    lib.un(star, 'mouseover', me.onMouseOver);
                    lib.un(star, 'mouseout', me.onMouseOut);
                });

                delete this.stars;

                this.parent('dispose');
            }
        });

        return Rating;
    }
);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-CalendarExtension.html">CalendarExtension</a></li><li><a href="module-City.html">City</a></li><li><a href="module-Control.html">Control</a></li><li><a href="module-Dialog.html">Dialog</a></li><li><a href="module-DialogFactory.html">DialogFactory</a></li><li><a href="module-Filter.html">Filter</a></li><li><a href="module-FloatTip.html">FloatTip</a></li><li><a href="module-Lazy.html">Lazy</a></li><li><a href="module-LazyImg.html">LazyImg</a></li><li><a href="module-lib.html">lib</a></li><li><a href="module-log.html">log</a></li><li><a href="module-Lunar.html">Lunar</a></li><li><a href="module-Pager.html">Pager</a></li><li><a href="module-PicUploader.html">PicUploader</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-Rating.html">Rating</a></li><li><a href="module-ScrollBar.html">ScrollBar</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Slider.html">Slider</a></li><li><a href="module-Tabs.html">Tabs</a></li><li><a href="module-Tip.html">Tip</a></li><li><a href="TimeLine.html">TimeLine</a></li></ul><h3>Classes</h3><ul><li><a href="initialize.html">initialize</a></li><li><a href="module-Dialog-Mask.html">Mask</a></li><li><a href="module-Slider.SliderAnim.html">SliderAnim</a></li></ul><h3>Events</h3><ul><li><a href="CalendarExtension-Menu.html#event:beforeShow">beforeShow</a></li><li><a href="CalendarExtension-Menu.html#event:click">click</a></li><li><a href="CalendarExtension-Menu.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:beforeShow">beforeShow</a></li><li><a href="module-Calendar.html#event:hide">hide</a></li><li><a href="module-Calendar.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:show">show</a></li><li><a href="module-City.html#event:beforeShow">beforeShow</a></li><li><a href="module-City.html#event:click">click</a></li><li><a href="module-City.html#event:hide">hide</a></li><li><a href="module-City.html#event:pick">pick</a></li><li><a href="module-City.html#event:show">show</a></li><li><a href="module-Control.html#event:disable">disable</a></li><li><a href="module-Control.html#event:dispose">dispose</a></li><li><a href="module-Control.html#event:enable">enable</a></li><li><a href="module-Dialog.html#event:beforedispose">beforedispose</a></li><li><a href="module-Dialog.html#event:beforehide">beforehide</a></li><li><a href="module-Dialog.html#event:beforeshow">beforeshow</a></li><li><a href="module-Dialog.html#event:cancel">cancel</a></li><li><a href="module-Dialog.html#event:confirm">confirm</a></li><li><a href="module-Dialog.html#event:dispose">dispose</a></li><li><a href="module-Dialog.html#event:hide">hide</a></li><li><a href="module-Dialog.html#event:show">show</a></li><li><a href="module-Filter.html#event:change">change</a></li><li><a href="module-Filter.html#event:click">click</a></li><li><a href="module-log.html#event:click">click</a></li><li><a href="module-log.html#event:send">send</a></li><li><a href="module-log.html#event:start">start</a></li><li><a href="module-Lunar.html#event:click">click</a></li><li><a href="module-Lunar.html#event:navigate">navigate</a></li><li><a href="module-Lunar.html#event:pick">pick</a></li><li><a href="module-Pager.html#event:change">change</a></li><li><a href="module-Pager.html#event:click">click</a></li><li><a href="module-PicUploader.html#event:error">error</a></li><li><a href="global.html#event:module:PicUploader:remove">module:PicUploader:remove</a></li><li><a href="module-Popup.html#event:beforeShow">beforeShow</a></li><li><a href="module-Popup.html#event:click">click</a></li><li><a href="module-Popup.html#event:hide">hide</a></li><li><a href="module-Popup.html#event:show">show</a></li><li><a href="module-Rating.html#event:rated">rated</a></li><li><a href="module-ScrollBar.html#event:change">change</a></li><li><a href="module-Select.html#event:beforeShow">beforeShow</a></li><li><a href="module-Select.html#event:change">change</a></li><li><a href="module-Select.html#event:hide">hide</a></li><li><a href="module-Select.html#event:pick">pick</a></li><li><a href="module-Select.html#event:show">show</a></li><li><a href="module-Slider.html#event:change">change</a></li><li><a href="module-Tabs.html#event:change">change</a></li><li><a href="module-Tip.html#event:beforeShow">beforeShow</a></li><li><a href="module-Tip.html#event:click">click</a></li><li><a href="module-Tip.html#event:hide">hide</a></li><li><a href="module-Tip.html#event:show">show</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-lib.array.html">array</a></li><li><a href="module-lib.browser.html">browser</a></li><li><a href="module-lib.configurable.html">configurable</a></li><li><a href="module-lib.date.html">date</a></li><li><a href="module-lib.dom.html">dom</a></li><li><a href="module-lib.event.html">event</a></li><li><a href="module-lib.fn.html">fn</a></li><li><a href="module-lib.object.html">object</a></li><li><a href="module-lib.observable.html">observable</a></li><li><a href="module-lib.page.html">page</a></li><li><a href="module-lib.string.html">string</a></li></ul><h3>Global</h3><ul><li><a href="global.html#beforeSwitch">beforeSwitch</a></li><li><a href="global.html#disable">disable</a></li><li><a href="global.html#dispose">dispose</a></li><li><a href="global.html#enable">enable</a></li><li><a href="global.html#isBusy">isBusy</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#setOpacity">setOpacity</a></li><li><a href="global.html#switchTo">switchTo</a></li><li><a href="global.html#tick">tick</a></li><li><a href="global.html#timeHandler">timeHandler</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Sat Dec 28 2013 21:48:14 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
